//
//  MarketDataModel.swift
//  SwiftfulCrypto
//
//  Created by Artyom Jalilov on 8/1/25.
//

import Foundation

// JSON data
/*
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON response:
 {
   "data":{
     "active_cryptocurrencies":16519,
     "upcoming_icos":0,
     "ongoing_icos":49,
     "ended_icos":3376,
     "markets":1198,
     "total_market_cap":{
       "btc":36580600.27744695,
       "eth":1035768123.3796786,
       "ltc":33966759216.217148,
       "bch":7974177303.937157,
       "bnb":5015014528.756079,
       "eos":4328229422276.9434,
       "xrp":1500696525357.181,
       "xlm":8219763912141.363,
       "link":167712722364.17194,
       "dot":506117047027.3488,
       "yfi":424488628.17579186,
       "usd":3506344300752.2964,
       "aed":12878732489777.17,
       "ars":3.631678542719244e+15,
       "aud":5648138615358.024,
       "bdt":426507148470540.94,
       "bhd":1321600774806.653,
       "bmd":3506344300752.2964,
       "brl":21503424313765.32,
       "cad":5048785158653.23,
       "chf":3192365193997.132,
       "clp":3526786288025682.5,
       "cny":25707464509825.613,
       "czk":85560060454807.16,
       "dkk":25395922312359.473,
       "eur":3403941515448.8257,
       "gbp":2840882228601.12,
       "gel":9870359206617.715,
       "hkd":27278780113043.242,
       "huf":1410671744822492.2,
       "idr":5.694410263590752e+16,
       "ils":12859395000958.52,
       "inr":301212671954308.2,
       "jpy":555026252054682.4,
       "krw":5.128052617916546e+15,
       "kwd":1080953352757.4215,
       "lkr":1038955654564057.5,
       "mmk":7.356310342978316e+15,
       "mxn":71556278826346.31,
       "myr":15787315214137.217,
       "ngn":5.417933086636433e+15,
       "nok":39989004708414.85,
       "nzd":6256538440358.758,
       "php":205315761234422.6,
       "pkr":978068480176040.6,
       "pln":14545659089387.71,
       "rub":368167862675009.75,
       "sar":13160456735309.715,
       "sek":39168537673760.305,
       "sgd":4800676235931.996,
       "thb":121541580109628.98,
       "try":124009583659910.92,
       "twd":115204451851861.73,
       "uah":148465798686980.16,
       "vef":351090254834.32745,
       "vnd":8.899353310322576e+16,
       "zar":66176463208603.33,
       "xdr":2702970694563.93,
       "xag":115894987792.10762,
       "xau":1315825825.7433143,
       "bits":36580600277446.945,
       "sats":3.658060027744695e+15
     },
     "total_volume":{
       "btc":2285997.670791366,
       "eth":64727300.79789554,
       "ltc":2122653315.245783,
       "bch":498322898.06672245,
       "bnb":313398671.55732137,
       "eos":270480044147.2226,
       "xrp":93781642059.22762,
       "xlm":513670115172.9025,
       "link":10480716275.258835,
       "dot":31628305218.535152,
       "yfi":26527175.823452827,
       "usd":219118736262.34964,
       "aed":804818735916.8849,
       "ars":226951133298859.94,
       "aud":352963910408.42566,
       "bdt":26653317348120.105,
       "bhd":82589576715.79602,
       "bmd":219118736262.34964,
       "brl":1343793637132.1003,
       "cad":315509068344.1571,
       "chf":199497529905.00128,
       "clp":220396198494759.12,
       "cny":1606512838654.6687,
       "czk":5346825842905.724,
       "dkk":1587043919819.0227,
       "eur":212719373569.80768,
       "gbp":177532629544.59082,
       "gel":616819242578.5143,
       "hkd":1704707613529.597,
       "huf":88155806587558.72,
       "idr":3.558555217893605e+15,
       "ils":803610296086.398,
       "inr":18823405337197.75,
       "jpy":34684743000439.836,
       "krw":320462656472048.2,
       "kwd":67551019608.638435,
       "lkr":64926496240501.695,
       "mmk":459711108678409.4,
       "mxn":4471700450152.966,
       "myr":986582110021.2292,
       "ngn":338577888897857.3,
       "nok":2498995941219.185,
       "nzd":390984078812.251,
       "php":12830608256803.693,
       "pkr":61121530281047.83,
       "pln":908988440492.2146,
       "rub":23007574237489.996,
       "sar":822424269019.356,
       "sek":2447723252527.4756,
       "sgd":300004226566.23315,
       "thb":7595385721600.999,
       "try":7749616388256.508,
       "twd":7199365417754.494,
       "uah":9277936048519.748,
       "vef":21940359061.949066,
       "vnd":5.561390678296079e+15,
       "zar":4135504601037.014,
       "xdr":168914251409.92007,
       "xag":7242518442.555267,
       "xau":82228688.15717193,
       "bits":2285997670791.366,
       "sats":228599767079136.62
     },
     "market_cap_percentage":{
       "btc":54.14714315722106,
       "eth":11.640144780539678,
       "usdt":3.9287520146620554,
       "xrp":3.829117915961608,
       "bnb":2.9105445047729597,
       "sol":2.7437279212766112,
       "doge":1.480257479483987,
       "usdc":1.3023713592180048,
       "ada":1.0089738729202473,
       "steth":0.9294785229807413
     },
     "market_cap_change_percentage_24h_usd":-6.478888345233845,
     "updated_at":1736348982
   }
 }
 
 
 */

struct GlobalData: Codable {
  let data: MarketDataModel?
}

struct MarketDataModel: Codable {
  let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
  let marketCapChangePercentage24HUsd: Double
  
  enum CodingKeys: String, CodingKey {
    case totalMarketCap = "total_market_cap"
    case totalVolume = "total_volume"
    case marketCapPercentage = "market_cap_percentage"
    case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
  }
  
  var marketCap: String {
    if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
      return "\(item.value)"
    }
    return ""
  }
  
  var volume: String {
    if let item = totalVolume.first(where: { $0.key == "usd" }) {
      return "\(item.value)"
    }
    return ""
  }
  
  var btcDominance: String {
    if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
      return item.value.asPercentString()
    }
    return "
  }
}
